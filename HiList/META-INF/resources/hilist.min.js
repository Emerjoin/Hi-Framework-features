    /**
     * Hi list component
     * @author The Hi Framework Team
     */

    var hiList =  {};


    /**
     * The extensions should override methods of this class.
     */
    hiList.baseExtension = function(){


        /**
         * Transform the hiList HTML before it gets compiled.
         * @param html the hiList HTML
         * @param scope the hiList angular scope
         */
        this.$preTransform = function(html,scope){


        };


        /**
         * Notifies the extension before filtering is executed.
         * @param scope the angular scope
         * @param DOM element of the hiList instance
         * @param filter the filter properties
         * @param ordering the data ordering properties
         * */
        this.$beforeFilter = function(scope,element, filter,ordering){



        };

        /**
         *
         * @param scope
         * @param element
         * @param display
         */
        this.$beforeDisplay = function(scope,element,display){



        };

        this.$startup = function(){



        };


    };

    hiList.extensions = {};
    hiList.extend = function(factory){

        var extInstance = new hiList.baseExtension();
        var extension = factory.call({},extInstance);

        if(!(extension.hasOwnProperty("build")&&extension.hasOwnProperty("name")))
            throw new Error("A hiList extension should contains at least the name property and the build function");


        extension.$newInstance = function(){

            //use dependency injection
            if(extension.hasOwnProperty("inject")) {


                var fn =  extension.build;
                fn["$inject"] = extension.inject;

                console.log(fn);
                return angular.injector().invoke(fn);

            }


            //Just call the damm function
            return extension.build.call({});


        };

        hiList.extensions[extension.name] = extension;

    };

    hiList.getExtension = function(name){

        if(!hiList.extensions.hasOwnProperty(name))
            throw new Error("Extension not encountered : "+name);


        var extension = hiList.extensions[name];

        //There is a single instance if the extension in the entire application
        if(extension.hasOwnProperty("singleton")){

            if(extension.hasOwnProperty("instance")){

                return extension.instance;

            }

            extension.instance = extension.$newInstance();
            extension.instance.$startup();
            hiList[name] = extension;
            return extension.instance;

        }

        //The extension supports multiple instances : one instance per hiList
        var extension = extension.$newInstance();
        extension.$startup();
        return extension;


    };



    //---Extension sample begins here---

    hiList.extend(function(extension){

        return {

            name:"name1",
            singleton:false,
            //inject : ['$compile'],
            build: function(){

                //Override the instance methods here
                extension.$startup = function(html){

                    console.log("I'm just a stupid extension");


                };

                return extension;

            }

        };

    });
    //---Extension sample ends here---*/

    hiList.html = {};
    hiList.html.header =
        '<div class="form-group col-md-4 col-lg-4 col-sm-4 col-xs-6">'+
        '<input type="text" ng-model="filter.text" class="form-control" placeholder="Pesquisar">'+
        '</div>'+
        '<div class="col-md-7 col-lg-7 col-sm-7 col-xs-6"></div>'+
        '<div class="col-md-1 col-lg-1 col-sm-1 hiden-xs">'+
        '<select class="form-control" ng-model="show.maxItems" ng-options="x for x in maxItemsOptions"></select>'+
        '</div>';

    hiList.html.footer =
        '<nav class="col-md-12 col-lg-12 col-sm-12">'+
        '<ul class="pagination">'+
        '<li>'+
        '<a href="#" aria-label="Previous">'+
        '<span aria-hidden="true">&laquo;</span>'+
        '</a>'+
        '</li>'+
        '<li><a href="#">1</a></li>'+
        '<li><a href="#">2</a></li>'+
        '<li><a href="#">3</a></li>'+
        '<li><a href="#">4</a></li>'+
        '<li><a href="#">5</a></li>'+
        '<li>'+
        '<a href="#" aria-label="Next">'+
        '<span aria-hidden="true">&raquo;</span>'+
        '</a>'+
        '</li>'+
        '</ul>'+
        '</nav>';

    hiList.directive = function($compile){

        var directive = {};
        directive.restrict='E';
        directive.link = function($scope,element,attributes) {

            $scope.maxItemsOptions=[25,50,150,200];
            $scope.show ={maxItems:25};


            //Watch filter text
            $scope.$watch("filter.text",function(newValue,oldValue){

                $scope.$doFilter();


            });


            //Watch items per page
            $scope.$watch("show.maxItems",function(newValue,oldValue){

                $scope.$doFilter();

            });

            $scope.$doFilter = function(){

                console.log("filter function invoked");

            };


            //The public method
            $scope.refresh = function(){

                //TODO: Implement this function


            };

            $scope.goToPage = function(number){

                //TODO: Implement this function


            };

            $scope.goToLastPage = function() {

                //TODO: Implement this function

            };

            $scope.goToFirstPage = function(){

                //TODO: Implement this function

            };

            $scope.getCurrentPage = function(){

                //TODO: Implement this function

            };

            $scope.goToNextPage = function(){

                //TODO: Implement this function

            };

            $scope.goToPreviousPage = function(){

                //TODO: Implement this function

            };





            //Extension instances for this particular List
            $scope.$extensions = {};
            $scope.$extensionList = [];

            $scope.$bootExtensions = function(){

                //Load the extensions for this hiList instance
                var props = Hi.$util.getKidProperties('plugin',attributes['$attr']);
                if(props.length>0){

                    $scope.$extensionList = props;

                    for(var index in props){



                        var item = props[index];
                        if(typeof item=="string"){

                            var extension  = hiList.getExtension(item);
                            $scope.$extensions[item] = extension;

                        }



                    }



                }

            };



            $scope.$bootExtensions();

            $scope.rows = [{id:1,name:"Mario Junior"}];

            //Name
            if(!attributes.hasOwnProperty("name"))
                throw new Error("The list element should have a <name> attribute");

            //Repeatale
            if(!attributes.hasOwnProperty("repeatElement"))
                throw new Error("The list element should have a <repeat-element> attribute that specifies the element that should be repeated.");


            //Item name
            if(!attributes.hasOwnProperty("item"))
                throw new Error("The list element should have a <item> attribute that specifies the name to repeat");



            //Items per page
            if(attributes.hasOwnProperty("perPage")){

                var itemsPerPage = parseInt(attributes.perPage);
                if(!isNaN(itemsPerPage)){

                    if($scope.maxItemsOptions.indexOf(itemsPerPage)==-1) {
                        throw new Error("Invalid max items per page : " + itemsPerPage + ". Should be one of the following : "+$scope.maxItemsOptions.toString());
                    }

                    $scope.show.maxItems = itemsPerPage;

                }

            }


            var eachItem = attributes.item;
            var scopeParent = $scope.$parent;
            var listName = attributes.name;
            var listRepeatElement = attributes["repeatElement"];


            var jqRepeatable = element.find(listRepeatElement);

            if(jqRepeatable.length==0)
                throw new Error("Repeatable element could not be found using the specifiend jQuery selector : "+listRepeatElement);


            if(scopeParent.hasOwnProperty(listName))
                console.warn("The list name <"+listName+"> is already in use on its parent scope");


            //The attributes of the element
            $scope.$attributes = attributes;

            //Add the ng-repeat
            jqRepeatable.attr("ng-repeat",eachItem+" in rows");


            //TODO: Add the header
            var header = $("<header>").addClass("row hilist-header").html(hiList.html.header);
            $(element).prepend(header);


            //TODO: Add the footer
            var footer = $("<footer>").addClass("row hilist-footer").html(hiList.html.footer);
            $(element).append(footer);


            //TODO: Call plugins to transform the markup


            var angularElement = angular.element($(element).html());


            var compile = $compile(angularElement,function(){

                //TODO: Call the plugins to transform the scope

            });
            element.html(angularElement);

            //Add the scope object to the its parent
            scopeParent[listName] = $scope;

            //
            compile($scope);


        };

        return directive;


    };


    Hi.$ui.js.component("list",hiList.directive);